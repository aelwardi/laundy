<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <title>Laundry - Service de laverie & pressing en 48h</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  {% block stylesheets %}
  {{ encore_entry_link_tags('app') }}
  {% endblock %}
</head>

<body class="bg-white font-sans">
    <nav id="navbar"
    class="fixed top-0 left-0 w-full z-50 transition-colors duration-300 bg-white px-8 py-4 flex items-center justify-between">
    <div id="logo" class="text-black font-bold text-2xl transition-colors duration-300">Laundry</div>
    <div class="flex-1 flex justify-center space-x-8">
      <a href="#" class="nav-link text-black hover:underline transition-colors duration-300">Comment ça fonctionne</a>
      <a href="#" class="nav-link text-black hover:underline transition-colors duration-300">Prix et services</a>
      <a href="#" class="nav-link text-black hover:underline transition-colors duration-300">À propos de nous</a>
      <a href="#"
        class="nav-link text-gray-400 font-semibold hover:underline transition-colors duration-300">Connectez-vous</a>
    </div>
    <a href="#" id="cta-btn"
      class="ml-4 bg-blue-500 text-white font-semibold px-4 py-2 rounded shadow hover:bg-blue-100 transition-colors duration-300">Réservez
      dès maintenant</a>
  </nav>
  
  <main class="max-w-5xl mx-auto mt-30">
    {% for message in app.flashes('success') %}
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        {{ message }}
      </div>
    {% endfor %}
    
    {% for message in app.flashes('error') %}
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ message }}
      </div>
    {% endfor %}

    <h2 class="text-2xl font-bold mb-4 text-gray-500 border-b-2 border-gray-300">Historique des Tickets</h2>
    <div class="flex bg-white rounded-lg border">
      <!-- Sidebar Tickets List -->
      <div class="w-80 bg-gray-50 border-r rounded-l-lg">
        <button id="btn-nouveau-ticket" class="w-full bg-blue-500 text-white font-semibold py-3 rounded-tl-lg rounded-tr-lg mb-2 transition">Nouveau Ticket</button>
        <div>
          {% for ticket in tickets %}
            <div onclick="showTicket('ticket-{{ ticket.id }}')" class="ticket-item flex items-start py-3 px-4 border-b space-x-3 hover:bg-gray-100 cursor-pointer">
              <div>
                <div class="flex items-center space-x-2">
                  <span class="bg-gray-100 text-gray-700 text-xs px-2 py-0.5 rounded">
                    {{ ticket.createdAt|date('d/m/Y H:i') }}
                  </span>
                </div>
                <div class="flex items-center space-x-2 mt-1">
                  <span class="text-gray-800 text-sm font-medium">{{ ticket.name }}</span>
                  <a href="#" class="text-blue-400 text-xs hover:underline">#{{ ticket.id }}</a>
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  {{ ticket.messages|length }} message{{ ticket.messages|length > 1 ? 's' : '' }}
                </div>
              </div>
            </div>
          {% else %}
            <div class="p-4 text-gray-500 text-sm text-center">
              Aucun ticket trouvé.<br>
              Créez votre premier ticket !
            </div>
          {% endfor %}
        </div>
      </div>
      <div class="flex-1 bg-gray-100 rounded-r-lg">
        <div id="panel-nouveau-ticket" class="p-6">
          <div class="border-b pb-3 mb-3">
            <h3 class="text-lg font-semibold">Créer un ticket</h3>
          </div>
          {{ form_start(form, {'attr': {'class': 'space-y-5'}}) }}
            <div>
              {{ form_widget(form.name) }}
              {{ form_errors(form.name) }}
            </div>
            <div>
              {{ form_widget(form.messageContent) }}
              {{ form_errors(form.messageContent) }}
            </div>
            <div class="flex justify-end">
              {{ form_widget(form.submit) }}
            </div>
          {{ form_end(form) }}
        </div>
        
        {% for ticket in tickets %}
          <div id="panel-ticket-{{ ticket.id }}" class="p-6 hidden">
            <div class="border-b pb-3 mb-3">
              <h3 class="text-lg font-semibold">{{ ticket.name }}</h3>
              <p class="text-sm text-gray-500">Créé le {{ ticket.createdAt|date('d/m/Y à H:i') }}</p>
            </div>
            <div class="space-y-5 mb-4">
              {% for message in ticket.messages %}
                <div class="{% if message.usere == app.user %}text-right{% endif %}">
                  {% if message.usere == app.user %}
                    <div class="inline-block bg-blue-100 text-blue-800 rounded-lg px-4 py-2 mb-1 max-w-xs">
                      {{ message.content|nl2br }}
                    </div>
                    <span class="block text-xs text-gray-400">{{ message.createdAt|date('d/m/Y H:i') }}</span>
                  {% else %}
                    <div class="flex items-start space-x-3">
                      <div class="flex-shrink-0 w-8 h-8 bg-green-500 text-white flex items-center justify-center rounded-full font-semibold">S</div>
                      <div>
                        <div class="bg-gray-200 text-gray-800 rounded-lg px-4 py-2 mb-1">
                          {{ message.content|nl2br }}
                        </div>
                        <span class="text-xs text-gray-400">{{ message.createdAt|date('d/m/Y H:i') }}</span>
                      </div>
                    </div>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
            <form class="mt-6" method="post" action="{{ path('app_ticket_reply', {'id': ticket.id}) }}">
              <textarea name="content" class="w-full border rounded-lg px-3 py-2 mb-3 resize-none" rows="4" placeholder="Votre réponse..." required></textarea>
              <input type="hidden" name="_token" value="{{ csrf_token('reply_ticket_' ~ ticket.id) }}">
              <div class="flex justify-end">
                <button type="submit" class="bg-cyan-500 text-white px-5 py-2 rounded-lg hover:bg-cyan-600 transition">Répondre</button>
              </div>
            </form>
          </div>
        {% endfor %}
      </div>
      <!-- End Right Panel -->
    </div>
  </main>
    <!-- Footer -->
  <footer class="bg-white py-8 border-t border-gray-400 mt-10 max-w-5xl mx-auto">
    <div class="flex flex-col md:flex-row justify-between items-center">
      <div class="text-xl font-bold mb-4 md:mb-0">Laundry</div>
      <div class="flex items-center space-x-4">
        <span class="text-gray-400 text-sm">Suivez-nous</span>
        <a href="#" class="text-gray-600 hover:text-gray-900">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M18.896 2.003H5.104A3.108 3.108 0 0 0 2 5.11v13.783a3.108 3.108 0 0 0 3.104 3.107h13.793A3.108 3.108 0 0 0 22 18.893V5.11a3.108 3.108 0 0 0-3.104-3.107zm-7.1 15.66h-2.933V9.572h2.933v8.091zm-1.467-9.206a1.7 1.7 0 1 1 0-3.399 1.7 1.7 0 0 1 0 3.399zm10.369 9.206h-2.933v-4.067c0-.97-.017-2.217-1.352-2.217-1.352 0-1.56 1.055-1.56 2.146v4.138h-2.933V9.572h2.818v1.063h.04c.393-.744 1.355-1.528 2.79-1.528 2.984 0 3.532 1.964 3.532 4.518v4.038z" />
          </svg>
        </a>
        <a href="#" class="text-gray-600 hover:text-gray-900">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 2.163c3.204 0 3.584.012 4.85.07 1.206.056 1.803.247 2.23.415.543.21.93.458 1.34.868.41.41.658.797.868 1.34.168.427.359 1.024.415 2.23.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.056 1.206-.247 1.803-.415 2.23-.21.543-.458.93-.868 1.34-.41.41-.797.658-1.34.868-.427.168-1.024.359-2.23.415-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.206-.056-1.803-.247-2.23-.415-.543-.21-.93-.458-1.34-.868-.41-.41-.658-.797-.868-1.34-.168-.427-.359-1.024-.415-2.23C2.175 15.797 2.163 15.417 2.163 12s.012-3.584.07-4.85c.056-1.206.247-1.803.415-2.23.21-.543.458-.93.868-1.34.41-.41.797-.658 1.34-.868.427-.168 1.024-.359 2.23-.415C8.416 2.175 8.796 2.163 12 2.163zm0-2.163C8.741 0 8.332.014 7.052.072c-1.292.06-2.18.264-2.948.528-.813.28-1.496.64-2.18 1.323-.684.684-1.043 1.367-1.323 2.18-.264.768-.468 1.656-.528 2.948C.014 8.332 0 8.741 0 12c0 3.259.014 3.668.072 4.948.06 1.292.264 2.18.528 2.948.28.813.64 1.496 1.323 2.18.684.684 1.367 1.043 2.18 1.323.768.264 1.656.468 2.948.528C8.332 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 1.292-.06 2.18-.264 2.948-.528.813-.28 1.496-.64 2.18-1.323.684-.684 1.043-1.367 1.323-2.18.264-.768.468-1.656.528-2.948.058-1.28.072-1.689.072-4.948 0-3.259-.014-3.668-.072-4.948-.06-1.292-.264-2.18-.528-2.948-.28-.813-.64-1.496-1.323-2.18-.684-.684-1.367-1.043-2.18-1.323-.768-.264-1.656-.468-2.948-.528C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zm0 10.162a3.999 3.999 0 1 1 0-7.998 3.999 3.999 0 0 1 0 7.998zm7.2-10.406a1.44 1.44 0 1 0 0 2.88 1.44 1.44 0 0 0 0-2.88z" />
          </svg>
        </a>
      </div>
    </div>
    <div class="mt-4 text-gray-400 text-sm flex justify-between">
      <span>Tous droits réservés. © Laundryheap 2025.</span>
    </div>
  </footer>
  <script>
    document.getElementById('btn-nouveau-ticket').onclick = function() {
      showPanel('panel-nouveau-ticket');
    };

    function showTicket(ticket) {
      showPanel('panel-' + ticket);
    }

    function showPanel(panelId) {
      // Masquer tous les panels
      const panels = document.querySelectorAll('[id^="panel-"]');
      panels.forEach(panel => {
        panel.classList.add('hidden');
      });
      
      // Afficher le panel sélectionné
      const targetPanel = document.getElementById(panelId);
      if (targetPanel) {
        targetPanel.classList.remove('hidden');
      }
    }

    // Afficher le panel nouveau ticket par défaut
    showPanel('panel-nouveau-ticket');
  </script>
</body>
</html>